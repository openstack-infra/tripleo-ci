---
# zuul.d/build-image.yaml
# Zuul layout for TripleO Build Image jobs.

- project-template:
    name: tripleo-buildimage-jobs
    check:
      jobs:
        - tripleo-buildimage-overcloud-full-centos-7
        - tripleo-buildimage-overcloud-full-centos-8
        - tripleo-buildimage-overcloud-full-centos-7-train
        - tripleo-buildimage-ironic-python-agent-centos-8
    gate:
      jobs:
        - tripleo-buildimage-overcloud-full-centos-7
        - tripleo-buildimage-overcloud-full-centos-8
        - tripleo-buildimage-overcloud-full-centos-7-train
        - tripleo-buildimage-ironic-python-agent-centos-8
    experimental:
      jobs:
        - tripleo-buildimage-ironic-python-agent-centos-7
        - tripleo-buildimage-overcloud-hardened-full-centos-7
        - tripleo-buildimage-ironic-python-agent-centos-8
        - tripleo-buildimage-overcloud-hardened-full-centos-8

# CentOS 8 Image Build Jobs
- job:
    name: tripleo-buildimage-ironic-python-agent-centos-8
    parent: tripleo-build-images-base-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: ironic-python-agent
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

- job:
    name: tripleo-buildimage-overcloud-full-centos-8
    parent: tripleo-build-images-base-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: overcloud-full
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

- job:
    name: tripleo-buildimage-overcloud-full-centos-7-train
    parent: tripleo-build-images-base
    override-checkout: 'stable/train'
    vars:
      tripleo_image_type: overcloud-full
      tripleo_image_os: centos7
      branch_override: stable/train
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

- job:
    name: tripleo-buildimage-overcloud-hardened-full-centos-8
    parent: tripleo-build-images-base-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: overcloud-hardened-full
    voting: false
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

# CentOS 7 Image Build Jobs
- job:
    name: tripleo-buildimage-ironic-python-agent-centos-7
    parent: tripleo-build-images-base
    branches: ^(stable/(pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: ironic-python-agent
      tripleo_image_os: centos7
    voting: false
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

- job:
    name: tripleo-buildimage-overcloud-full-centos-7
    parent: tripleo-build-images-base
    branches: ^(stable/(pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: overcloud-full
      tripleo_image_os: centos7
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$

- job:
    name: tripleo-buildimage-overcloud-hardened-full-centos-7
    parent: tripleo-build-images-base
    branches: ^(stable/(pike|queens|rocky|stein|train)).*$
    vars:
      tripleo_image_type: overcloud-hardened-full
      tripleo_image_os: centos7
    voting: false
    irrelevant-files:
      - ^.*\.rst$
      - ^releasenotes/.*$
